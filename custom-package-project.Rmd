---
title: "custom-package-project"
author: "Sam Smith"
date: "4/26/2022"
output: html_document
---

## Objectives

 The objective of this module is to describe how to use discriminant function analysis.
 
## Preliminaries

 what packages to load
 
## Discriminant function analysis

Background
what is DFA?
why do you use it?
what is the math under the hood?

## An example 
How do we do this in R?

Get table of module eigengene scores for each individual
```{r}
library(tidyverse)
library(dplyr)
g <- "data/reddrum_traits.csv"
traits <- read.csv(g)
```

what if we looked at replicate (maternal identity) and routine swimming behavior
```{r}
library(cowplot)
library(patchwork)
library(energy)
library(MASS)
library(Hmisc)
red_traits <- traits %>% dplyr::select("ID" = Matz_Number, "Mother" = Replicate,
                                "RDistancedMoved_cm" = RDistanceMoved_cm,
                                "RMeanSpeed" = RMeanSpeed, "RMeanAngSpd" = RMeanAngularSpd,
                                "RMeanMeander" = RMeanMeander,"RMeanMobility" = RMeanMobility)
red_traits$Mother <- as.factor(red_traits$Mother)
table(red_traits$Mother) # similar sample sizes
hist.data.frame(red_traits,nclass=20)
g1 <- ggplot(data=red_traits,aes(x=Mother,y=log(RMeanSpeed))) + geom_boxplot()
g2 <- ggplot(data=red_traits,aes(x=Mother,y=log(RDistancedMoved_cm))) + geom_boxplot()
g3 <- ggplot(data=red_traits,aes(x=Mother,y=log(RMeanMobility))) + geom_boxplot()
g4 <- ggplot(data=red_traits,aes(x=Mother,y=log(RMeanAngSpd))) + geom_boxplot()
g5 <- ggplot(data=red_traits,aes(x=Mother,y=log(RMeanMeander))) + geom_boxplot()
g1 + g2 + g3 + g4 + g5

p1 <- ggplot(data=red_traits,aes(x=Mother,y=RDistancedMoved_cm)) + geom_boxplot()
p2 <- ggplot(data=red_traits,aes(x=as.factor(Mother),y=RMeanSpeed)) + geom_boxplot()
p3 <- ggplot(data=red_traits,aes(x=as.factor(Mother),y=RMeanAngSpd)) + geom_boxplot()
p4 <- ggplot(data=red_traits,aes(x=as.factor(Mother),y=RMeanMeander)) + geom_boxplot()
p5 <- ggplot(data=red_traits,aes(x=as.factor(Mother),y=RMeanMobility)) + geom_boxplot()
plot_grid(p1,p2,p3,p4,p5)

logtrans_traits <- red_traits %>% mutate("logSpeed" = log(RMeanSpeed), "logDist" = log(RDistancedMoved_cm), "logMobility" = log(RMeanMobility),"logAngSpd" = log(abs(RMeanAngSpd)),"logMeander" = log(abs(RMeanMeander))) %>% dplyr::select(ID,Mother,logSpeed,logDist,logMobility,logAngSpd,logMeander)
hist.data.frame(logtrans_traits,nclass=20)
library(caret)
set.seed(60)
training.samples <- logtrans_traits$Mother %>% createDataPartition(p = 0.8, list = FALSE)
train.data <- logtrans_traits[training.samples,]
test.data <- logtrans_traits[-training.samples,]
hist.data.frame(train.data,nclass=20)
# normalize the data
preproc.param <- train.data %>% preProcess(method = c("center","scale"))
# transform using estimated parameters
train.transf <- preproc.param %>% predict(train.data)
test.transf <- preproc.param %>% predict(test.data)

library(MASS)
model <- lda(Mother ~ logSpeed + logDist + logMobility + logAngSpd + logMeander, data=train.transf)

pred_test <- model %>% predict(test.transf)

# Predicted classes
head(pred_test$class, 6)
# Predicted probabilities of class memebership.
round(pred_test$posterior,2)
# Linear discriminants
head(pred_test$x, 3)

lda.data <- cbind(train.transf,predict(model)$x)
mean(pred_test$class == test.transf$Mother)
```